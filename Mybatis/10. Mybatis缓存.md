# 缓存

## 简介

1. 什么是缓存[ cache ]？
   - 存在内存中的临时数据；
   - 将用户经常查询的数据放在缓存(内存)中，用户去查询数据就不用从磁盘上（关系型数据库数据文件）查询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题。
2. 为什么使用缓存？
   - 减少和数据库的交互次数，减少系统开销，提高系统效率。
3. 什么样的数据能使用缓存？
   - 经常查询且不经常改变的数据。

## Mybatis缓存

- Mybatis 包含一个非常强大的查询缓存特性，它可以非常方便地定制和配置缓存。缓存可以极大的提升查询效率。
- Mybatis系统中默认定义了两级缓存：一级缓存 和 二级缓存。
  - 默认情况下，只有一级缓存开启。（SqlSession级别的缓存，也称为本地缓存）；
  - 二级缓存需要手动开启和配置，它是基于namespace 级别的缓存；
  - 为了提高扩展性，Mybatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存。

## 一级缓存

- 一级缓存也叫本地缓存；
  - 与数据库同一次会话期间查询到的数据会放在本地缓存中；
  - 以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库；

## 二级缓存

- 二级缓存也叫全局缓存，一级缓存的作用域太小了，所以诞生了二级缓存；
- 基于namespace 级别的缓存，一个名称空间，对应一个二级缓存；
- 工作机制：
  - 一个会话查询一条数据，这个数据就会被放在当前会话的一级缓存中；
  - 如果当前会话关闭了，这个会话对应的一级缓存就没了；但是我们想要的是，会话关闭了，一级缓存中的数据被保存到二级缓存中；
  - 新的会话查询信息，就可以从二级缓存中获取内容；
  - 不同的mapper查出的数据会放在自己对应的缓存（map）中；

二级缓存开启步骤：

1. 核心配置文件中开启缓存；

   `mybatis-config.xml` 

   ```xml
   <settings>
   	<setting name="cacheEnabled" value="true"/>
   </settings>
   ```

2. 在mapper文件中加上cache标签

   `XxxMapper.xml` 

   ```xml
   <cache/>
   ```

   